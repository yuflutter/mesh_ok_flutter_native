# Mesh.OK

Групповой текстовый чат между несколькими устройствами Android, объединёнными в группу P2P через WiFi-direct. Первая попытка реализации на базе плагина flutter_p2p_connection оказалась не вполне удачной. Вот этот код:

https://github.com/yuflutter/mesh_ok_flutter_pure

Он работает, но из-за недостатков плагина и полном отсутcтвии обработки сетевых ошибок (все методы платформы возвращают true/false), пришлось отказаться от использования плагина, и переписать сетевую часть на котлин.

В итоге на котлин перенесено:
- Запрос разрешений и включение сетевых сервисов (асинхронный API андроида был преобразован в корутины).
- Реализация протокола WiFi-direct (кроме определения сетевых служб).

На флаттере осталось:
- Пользовательский интерфейс.
- Реализация клиентских и серверных вебсокетов.

## TODO

- Протестировать все редкие сетевые кейсы, усовершенствовать обработку ошибок.

- Непонятно, что делать, если третье устройство пытается подключиться к пиру, который уже входит в группу в качестве клиента (если целевой пир является хостом - подключение успешно проходит, а если целевой пир является клиентом - подключение зависает в статусе invited).

- Разобраться, насколько реально построить MESH (PS: нереально, так как устройство может входить только в одну группу P2P).

- Отказаться от прямого использования FlutterView, и оформить котлин-код в соответствии с рекомендациям к нативным плагинам флаттер.

- Разобраться с фоновым режимом на стороне котлина, похоже мы иногда теряем глобал-стейт или бродкаст. (PS: Вероятно это касается только дебаг-режима, в релизе пока не удалось поймать).

- В перспективе оформить сетевую часть отдельным публичным пакетом, который будет лучше, чем flutter_p2p_connection.
